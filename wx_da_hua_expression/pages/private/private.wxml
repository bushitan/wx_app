<!--latest.wxml-->

<view class="page"  >

    <!--目录-->
    <!--<view class="weui-flex page__bd_spacing category">
        <view class=""> 
            <label catchtap="selectCategory" data-select_category_id="" class=" {{selectCategory.category_id == null ? 'select' : 'unselect'}} ">
             <label class=" font">全选</label>
            </label> 
        </view>    
        <view class="weui-flex__item"> 
            <scroll-view  scroll-x="true"  >
                <block wx:for="{{category}}" 
                    wx:for-item="c_name">
                    <label catchtap="selectCategory"  data-select_category_id="{{c_name.category_id}}" class="{{selectCategory.category_id == c_name.category_id ? 'select' : 'unselect'}} ">
                        <label class=" font">{{c_name.name}}</label>
                    </label>
                </block>
            </scroll-view>
        </view>
        <view class=""> 
            <image src="../../images/ic_action_add.png" catchtap="navigateToCategory"  ></image>
        </view> 
    </view>-->
    <view class=" category">
        <view class="all"> 
            <label catchtap="selectCategory" data-select_category_id="" class=" {{selectCategory.category_id == null ? 'select' : 'unselect'}} font">全选</label> 
        </view>    
        <!--<view class=""> -->
            <scroll-view  scroll-x="true" style="width:{{categoryScrollWidth}}px;"  >
                <block wx:for="{{category}}" 
                    wx:for-item="c_name">
                    <label catchtap="selectCategory"  data-select_category_id="{{c_name.category_id}}" class="{{selectCategory.category_id == c_name.category_id ? 'select' : 'unselect'}} font">{{c_name.name}}</label>
                </block>
            </scroll-view>
        <!--</view>-->
        <view class="add"> 
            <image src="../../images/ic_action_add.png" catchtap="navigateToCategory"  ></image>
        </view> 
    </view>

   
    <!--public Menu菜单-->  
    <view class="emoticon-menu"  hidden="{{menuType != '0' ? false:true}}">

        <!--右上角菜单-->
        <view class="weui-flex  ">
            <view class="weui-flex__item"></view>
            <view >
                <!--<icon type="cancel" catchtap="menuDelete"/>-->
                <label class="base_btn delete" catchtap="menuDelete" >删除</label>
                <label class="base_btn category__select" catchtap="menuMoveCategory" >分组</label>
                <label catchtap="hiddenAll">
                    <image src="../../images/ic_action_cancel_black.png" class="hidden__all" ></image>
                </label>
            </view>
        </view>

        <view class="space-4">  </view>

        <!--emoticon框 显示JPG或MP4-->
        <view class="weui-flex  "  catchtap="hiddenAll" style="background-color: #EBEBEB;">
            <view class="weui-flex__item page__bd_spacing"> 
                <view class="placeholder">
                    <image hidden="{{menuType == MENU_TYPE.VIDEO ? true:false}}" class="weui-media-box__thumb" mode="aspectFit" src="{{selectEmoticon.img_url}}"  bindload="bindload"/>
                    <video hidden="{{menuType == MENU_TYPE.VIDEO ? false:true}}" class="weui-media-box__thumb" src="{{selectEmoticon.img_url}}" catchtap="null"></video> <!--点击视频不关闭-->
                </view>
            </view>
        </view>
        <view class="space-4">  </view>
        <!--按钮栏  jpg/gif-->
        <view  hidden="{{menuType == MENU_TYPE.VIDEO ? true:false}}" >
            <view class="weui-flex page__bd_spacing btn_bar " hidden="{{joinShow}}" >
                <view class="weui-flex__item"> </view>
                <view > 
                    <button size="mini" catchtap="navigateToWatermark" >水印</button>
                    <button size="mini" catchtap="menuJoin" >GIF拼接</button>
                    <button class="" type="primary" catchtap="menuShare" size="mini" >全屏预览</button>
                </view>
                <view class="weui-flex__item"> </view>
            </view>
            
            <!--按钮栏  join拼接-->
            <view class="join-new page__bd_spacing" hidden="{{!joinShow}}">
                <view class="weui-flex">
                    <view class="weui-flex__item"></view>
                    <view >
                        <image catchtap="joinCancel" class="back" src="../../images/ic_action_undo.png" />
                    </view>
                </view>
                <view class="weui-flex ">
                    <view class="weui-flex__item">
                        <button size="mini" catchtap="joinSet" data-action="1">第一幅</button>
                    </view>
                    <view class="weui-flex__item"> 
                        <button size="mini" catchtap="joinSet" data-action="2">第二幅</button>
                    </view>
                    <view class="weui-flex__item">
                        <button size="mini" disabled="{{joinImg.status == 2?false:true}}" loading="{{isUpload}}" catchtap="joinConfirm" data-action="" type="primary" >拼接</button>
                    </view>
                </view>
                <view class="space-4">  </view>
                <view class="weui-flex ">
                    <view class="weui-flex__item">  <image  class= "image" src="{{joinImg.first}}" mode="aspectFit" ></image> 
                    </view>
                    <view class="weui-flex__item"> 
                        <image  class= "image" src="{{joinImg.seconde}}" mode="aspectFit" ></image>
                    </view>
                    <view class="weui-flex__item"> <image  class= "image" src="{{joinImg.resualt}}" ></image></view>
                </view>
                <view class="weui-flex">
                    <view class="weui-flex__item page__desc video2gif__des">把两个表情按顺序接一起喔</view>
                </view>
            </view>
        </view>

        <!--按钮栏  mp4-->
        <view class="video2gif" hidden="{{menuType == MENU_TYPE.VIDEO ? false:true}}">
            <view class="weui-flex">
                <view class=""> 
                    <view class="weui-cells__title">开始时间：</view>
                </view>    
                <view class="weui-flex__item"> 
                    <slider bindchange="starTimeChange" show-value value="0" min="0" max="{{selectEmoticon.duration}}"/>
                </view>
            </view>
            <view class="weui-flex">
                <view class=""> 
                    <view class="weui-cells__title">持续时间：</view>
                </view>
                <view class="weui-flex__item"> 
                    <view><slider bindchange="durationTimeChange" show-value value="6" min="1" max="6"/></view>
                </view>
            </view>
            <view class="weui-btn-area">
                <button class="weui-btn" type="primary" loading="{{isUpload}}" catchtap="menuVideo2Gif" >制作GIF</button>
            </view>
            <view class="weui-flex">
                <view class="weui-flex__item page__desc video2gif__des">视频片段制作GIF(需设置GIF开始、持续时间)</view>
            </view>
        </view>
 
    </view>  


    <!--emoticon表情显示列表-->
    <scroll-view class="emoticon-wall" scroll-y="true" style="height:{{windowHeight}}px;" bindscrolltolower="emoticonScrollTolower" >
        <view class="weui-grids">
            <block wx:for-items="{{emoticon}}"  wx:for-item="emoticon">
                <navigator url="" class="emoticon-grid" hover-class="weui-grid_active"
                catchtap="onMenu" data-img_id="{{emoticon.img_id}}" data-img_url="{{emoticon.thumbnail_url}}" data-category_id="{{emoticon.category_id}}"  data-size="{{emoticon.size}}" data-static_url="{{emoticon.static_url}}"   data-yun_url="{{emoticon.yun_url}}" data-menu_type="{{emoticon.menu_type}}
                data-width="{{emoticon.width}}" data-height="{{emoticon.height}}"  data-duration="{{emoticon.duration}}"  >
                <image class="emoticon-grid__icon" src="{{emoticon.static_url}}" background-size="cover" mode="center"  />
                    <image wx:if="{{ emoticon.menu_type == 4 ? true :false}}" class="emoticon-grid__mark " src="../../images/mp4.png"></image>
                <image wx:if="{{ emoticon.menu_type == 1 ? true :false}}" class="emoticon-grid__mark " src="../../images/gif.png"></image>
                </navigator>
            </block>
        </view>
        <view class="space-64"></view>
            
    </scroll-view>

    <!--loading框-->
    <view class="page__bd" hidden="{{!loadShow}}">
        <view class="weui-loadmore">
            <view class="weui-loading"></view>
            <view class="weui-loadmore__tips">正在加载</view>
        </view>
        <view class="weui-loadmore weui-loadmore_line">
            <view class="weui-loadmore__tips weui-loadmore__tips_in-line">暂无数据</view>
        </view>
        <view class="weui-loadmore weui-loadmore_line weui-loadmore_dot">
            <view class="weui-loadmore__tips weui-loadmore__tips_in-line weui-loadmore__tips_in-dot"></view>
        </view>
    </view>

    <!--图片、视频上传-->
    <view class="upload">
        <view wx:if="{{isUpload}}">
            <image  src="../../images/upload.gif" background-size="cover" catchtap="btnIsUpload"></image>
        </view>
        <view wx:else>
            <image  src="../../images/ic_action_add.png" background-size="cover" catchtap="btnUpload"></image>
        </view>
    </view>

    <!--临时文件 按钮-->
    <view class="temp" catchtap="tempSwitch" wx:if="{{temp.emoticon.length>0}}">
        <label class="title" wx:if="{{temp.show}}">关闭</label>
        <label class="title" wx:else>{{temp.emoticon.length}}</label>
    </view>

    <!--临时文件  显示列表-->
    <scroll-view class="temp__wall" hidden="{{!temp.show}}"
    scroll-y="true" style="height:{{windowHeight+42}}px;"
    >   
        <view class="page__hd">
            <view class="page__title">临时表情</view>
            <view class="page__desc">退出表情袋，临时表情会消失，请及时保存</view>
            <view class="page__desc">保存方法：点击表情->右上角按钮->保存图片</view>
        </view>
        <view class="weui-grids">
            <block wx:for="{{temp.emoticon}}" wx:for-index="index" wx:for-item="item">
                <navigator url="" class="emoticon-grid-3" hover-class="weui-grid_active"
                catchtap="tempPreview"  data-src="{{item}}" >
                <image class="emoticon-grid__icon-3" src="{{item}}" background-size="cover" mode="aspectFit" />
                </navigator>
             </block>
        </view>
        <view class="weui-btn-area">
            <button class="weui-btn" catchtap="tempClear">清除</button>
        </view>
        <view class="space-64"></view>
    </scroll-view>










    <!--目录选择列表-->
    <scroll-view class="select-category" wx:if="{{selectCategoryShow}}"
    scroll-y="true" style="height:{{windowHeight}}px;"
    catchtap="closeMove"  >   
        <view class="space-72"></view>
         <block wx:for="{{category}}" wx:for-index="index" wx:for-item="item">
            <button  catchtap="buttonMove"  data-index="{{index}}">{{item.name}}</button>
        </block>
    </scroll-view>


</view>